generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(uuid())
  email     String     @unique
  password  String
  name      String?
  campaigns Campaign[]
  settings  Settings?
  alerts    Alert[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("users")
}

model Campaign {
  id             String           @id @default(uuid())
  userId         String
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  metaId         String           @unique
  name           String
  objective      String
  status         String           @default("PAUSED")
  dailyBudget    Float?
  lifetimeBudget Float?
  adSets         AdSet[]
  metrics        CampaignMetric[]
  alerts         Alert[]
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@index([userId])
  @@index([status])
  @@map("campaigns")
}

model CampaignMetric {
  id          String   @id @default(uuid())
  campaignId  String
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  date        DateTime
  spend       Float
  impressions Int
  clicks      Int
  conversions Int
  ctr         Float?
  cpc         Float?
  roas        Float?
  createdAt   DateTime @default(now())

  @@unique([campaignId, date])
  @@index([campaignId])
  @@index([date])
  @@map("campaign_metrics")
}

model AdSet {
  id          String   @id @default(uuid())
  campaignId  String
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  metaId      String   @unique
  name        String
  status      String   @default("PAUSED")
  dailyBudget Float?
  targeting   String?
  ads         Ad[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([campaignId])
  @@map("ad_sets")
}

model Ad {
  id        String   @id @default(uuid())
  adSetId   String
  adSet     AdSet    @relation(fields: [adSetId], references: [id], onDelete: Cascade)
  metaId    String   @unique
  name      String
  status    String   @default("PAUSED")
  creative  String?
  mediaUrl  String?
  mediaType String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([adSetId])
  @@map("ads")
}

model Settings {
  id                      String   @id @default(uuid())
  userId                  String   @unique
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  monthlyBudgetLimit      Float    @default(5000)
  alertAt50Percent        Boolean  @default(true)
  alertAt80Percent        Boolean  @default(true)
  alertAt100Percent       Boolean  @default(true)
  alertOnProjectedOverrun Boolean  @default(true)
  conversionGoal          Int?
  roasGoal                Float?
  cpcMaxLimit             Float?
  ctrMinLimit             Float?
  whatsappEnabled         Boolean  @default(false)
  whatsappNumber          String?
  dailyReportTime         String   @default("09:00")
  sendDailyReports        Boolean  @default(true)
  sendImmediateAlerts     Boolean  @default(true)
  sendSuggestions         Boolean  @default(true)
  sendStatusChanges       Boolean  @default(true)
  metaAccessToken         String?
  metaAdAccountId         String?
  metaPageId              String?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@map("settings")
}

model Alert {
  id           String    @id @default(uuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  type         String    @default("info")
  priority     String    @default("medium")
  title        String
  message      String
  campaignId   String?
  campaign     Campaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  campaignName String?
  read         Boolean   @default(false)
  createdAt    DateTime  @default(now())

  @@index([userId])
  @@index([read])
  @@index([createdAt])
  @@map("alerts")
}
